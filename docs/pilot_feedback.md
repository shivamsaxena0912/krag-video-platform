# Pilot Feedback System

This guide covers the pilot feedback capture system, including simulated founder personas for testing.

## Overview

The feedback system enables:

1. **Structured Feedback Capture**: Capture founder feedback with decisions, flags, and notes
2. **Simulated Founders**: Test pilots without real founders using realistic personas
3. **Feedback-Driven Flow**: Enforce proper pilot progression (feedback before next attempt)
4. **Enhanced Outcome Reports**: Rich feedback analysis in outcome reports

## Quick Start

### Interactive Feedback

Capture feedback interactively after a founder reviews a video:

```bash
python scripts/run_pilot.py --feedback <pilot_id> --attempt 1
```

You'll be prompted to enter:
- Decision: APPROVE / MINOR_CHANGES / MAJOR_CHANGES
- Flags: hook_weak, too_long, tone_mismatch, etc.
- Notes: Free-form feedback text

### Simulated Feedback

Test with a simulated founder persona:

```bash
python scripts/run_pilot.py --simulate-feedback <pilot_id> --attempt 1 --persona speed_saas_founder
```

### File-Based Feedback

For async workflows, generate a template and submit later:

```bash
# Generate template
python scripts/run_pilot.py --feedback-template <pilot_id> --attempt 1

# Submit filled template
python scripts/run_pilot.py --submit-feedback <pilot_id> --attempt 1 --file feedback.json
```

## Feedback Data Model

### FeedbackDecision

```python
class FeedbackDecision(str, Enum):
    APPROVE = "approve"         # Ready to publish
    MINOR_CHANGES = "minor_changes"  # Small tweaks needed
    MAJOR_CHANGES = "major_changes"  # Significant rework
```

### FeedbackMode

```python
class FeedbackMode(str, Enum):
    HUMAN = "human"         # Real founder feedback
    SIMULATED = "simulated" # Generated by persona
```

### Feedback Flags

Standard flags that founders commonly use:

| Flag | Description |
|------|-------------|
| `hook_weak` | Opening doesn't grab attention |
| `too_long` | Video runs too long |
| `too_short` | Video is too brief |
| `tone_mismatch` | Doesn't match brand voice |
| `cta_unclear` | Call-to-action not clear |
| `pacing_flat` | Rhythm is monotonous |
| `pacing_rushed` | Too fast, hard to follow |
| `message_unclear` | Key message doesn't come through |
| `ending_weak` | Ending doesn't land |
| `visuals_poor` | Visual quality issues |
| `audio_issues` | Audio quality problems |
| `off_brand` | Doesn't feel like our brand |
| `wrong_audience` | Not right for target audience |

## Simulated Founder Personas

Five built-in personas for testing:

### speed_saas_founder

**"Speed-Obsessed SaaS Founder"**

- Moves fast, ships fast, wants videos yesterday
- Prioritizes speed over polish
- Platform bias: Twitter
- Max duration: 45s
- Approval threshold: Low (will approve "good enough")
- Feedback style: Terse ("Ship it." / "Too long. Cut it.")

### cautious_first_time_founder

**"Cautious First-Time Founder"**

- First startup, worried about brand perception
- Needs reassurance, overthinks details
- Platform bias: LinkedIn
- Max duration: 90s
- Approval threshold: High (perfectionist)
- Feedback style: Detailed, thorough explanations

### growth_marketer

**"Growth Marketer Founder"**

- All about conversion
- Obsessed with CTAs, hooks, and metrics
- Platform bias: Instagram
- Max duration: 60s
- Top concerns: cta_unclear, hook_weak, ending_weak
- Feedback style: Blunt ("The CTA gets lost. Make it obvious.")

### technical_founder

**"Technical Founder"**

- Engineer-turned-CEO
- Wants accuracy, hates fluff
- Skeptical of marketing speak
- Platform bias: YouTube
- Max duration: 120s
- Top concerns: message_unclear, wrong_audience, pacing_rushed
- Feedback style: Detailed, technical

### brand_sensitive_founder

**"Brand-Sensitive Founder"**

- Former brand/agency background
- Obsessed with visual quality and tone
- Platform bias: Instagram
- Max duration: 60s
- Approval threshold: Very high (quality bar: 0.9)
- Top concerns: off_brand, tone_mismatch, visuals_poor
- Feedback style: Diplomatic

### List Available Personas

```bash
python scripts/run_pilot.py --list-personas
```

### Custom Persona Parameters

Each persona has configurable parameters:

```python
@dataclass
class SimulatedFounderPersona:
    persona_id: str
    name: str
    description: str
    patience_level: float  # 0.0 (impatient) to 1.0 (patient)
    quality_bar: float     # 0.0 (accepts anything) to 1.0 (perfectionist)
    platform_bias: PlatformBias
    max_acceptable_duration_seconds: float
    min_acceptable_duration_seconds: float
    flag_weights: dict[str, float]  # Higher = more likely to flag
    feedback_style: FeedbackStyle   # BLUNT, DIPLOMATIC, TERSE, DETAILED
    approve_after_attempts: int     # Attempts before likely to approve
    major_changes_threshold: float  # Quality below this = MAJOR_CHANGES
```

## Pilot Flow Enforcement

The pilot system enforces proper feedback flow:

```
ATTEMPT #1 → Must receive feedback before...
    │
    ▼
ATTEMPT #2 → Must receive feedback before...
    │
    ▼
ATTEMPT #3 → ...
```

### Default Behavior

```bash
# This will fail if attempt 1 has no feedback
python scripts/run_pilot.py --continue-pilot pilot_123
# Error: Missing feedback for attempt 1. Use --feedback first.
```

### Force Override

Skip the feedback check with `--force`:

```bash
python scripts/run_pilot.py --continue-pilot pilot_123 --force
```

## Feedback in Outcome Reports

The outcome report now includes rich feedback analysis:

### Top Recurring Founder Objections

```markdown
## Top Recurring Founder Objections

- **Hook Weak** (3x)
- **Too Long** (2x)
- **Tone Mismatch** (2x)

### Issues Resolved
- Pacing flat

### Issues Still Unresolved
- Hook weak
- Too long
```

### Detailed Feedback by Attempt

```markdown
### Detailed Feedback by Attempt

**Attempt 1** - MAJOR_CHANGES (simulated)
- Flags: hook weak, too long, pacing flat
- Notes: "Way too slow. Start over."

**Attempt 2** - MINOR_CHANGES (simulated)
- Flags: hook weak
- Notes: "Hook needs work. Faster."

**Attempt 3** - APPROVE (human)
- Notes: "This works, send it."
```

### What the Founder Would Likely Say on a Call

```markdown
## What the Founder Would Likely Say on a Call

> "Yeah, we got a good video out of this. It took 3 attempts, but the final result works for us."
```

### Enhanced Recommendation Logic

The recommendation now considers feedback patterns:

| Pattern | Recommendation |
|---------|---------------|
| Latest decision = APPROVE | PROCEED |
| Repeated MAJOR_CHANGES + persistent flags | STOP |
| 3+ MAJOR_CHANGES decisions | STOP |
| Dropped after first attempt | STOP |
| Issues resolved over attempts | REVISE or PROCEED |

## Programmatic Usage

### Capture Feedback

```python
from src.pilot import PilotStore, FeedbackDecision, FeedbackMode

store = PilotStore("data/pilots")
pilot = store.load("pilot_123")

# Record human feedback
pilot.record_feedback(
    attempt_number=1,
    decision=FeedbackDecision.MINOR_CHANGES,
    flags=["hook_weak", "too_long"],
    notes="Hook needs work. Cut 10 seconds.",
    mode=FeedbackMode.HUMAN,
)

store.save(pilot)
```

### Generate Simulated Feedback

```python
from src.founder_simulation import generate_feedback, get_persona

# Get persona
persona = get_persona("speed_saas_founder")

# Generate deterministic feedback
feedback = generate_feedback(
    persona=persona,
    attempt_number=1,
    duration_seconds=55.0,
    sla_passed=True,
    scenario_type="feature_launch",
    intent="social_reel",
)

print(feedback.decision)  # FeedbackDecision.MINOR_CHANGES
print(feedback.flags)     # ["too_long", "hook_weak"]
print(feedback.notes)     # "Too long. Cut 10 seconds."

# Apply to pilot
pilot.record_feedback(
    attempt_number=1,
    decision=feedback.decision,
    flags=feedback.flags,
    notes=feedback.notes,
    mode=FeedbackMode.SIMULATED,
    persona=feedback.persona_id,
)
```

### Deterministic Simulation

Simulated feedback is deterministic given a seed:

```python
# Same inputs = same output
feedback1 = generate_feedback(
    persona="speed_saas_founder",
    attempt_number=1,
    duration_seconds=55.0,
    sla_passed=True,
    scenario_type="feature_launch",
    intent="social_reel",
    seed="my_test_seed",
)

feedback2 = generate_feedback(
    persona="speed_saas_founder",
    attempt_number=1,
    duration_seconds=55.0,
    sla_passed=True,
    scenario_type="feature_launch",
    intent="social_reel",
    seed="my_test_seed",
)

assert feedback1.decision == feedback2.decision
assert feedback1.flags == feedback2.flags
```

## Feedback Template Format

For file-based feedback, use this JSON format:

```json
{
  "pilot_id": "pilot_20240115_abc12345",
  "attempt_number": 1,
  "decision": "minor_changes",
  "flags": ["hook_weak", "too_long"],
  "notes": "The hook doesn't grab attention. Also, 55 seconds is too long for Instagram."
}
```

## Best Practices

1. **Always capture feedback before continuing** - Use `--force` only when truly needed
2. **Use simulated feedback for internal testing** - Real founders for actual pilots
3. **Be specific with flags** - They enable better analysis
4. **Include notes** - Context matters for iteration
5. **Review outcome reports** - Track patterns across pilots
6. **Match persona to scenario** - Test with the right founder type

## Troubleshooting

### Cannot continue pilot

```
Error: Missing feedback for attempt 1.
```

Either capture feedback or use `--force`:

```bash
python scripts/run_pilot.py --feedback pilot_123 --attempt 1
# or
python scripts/run_pilot.py --continue-pilot pilot_123 --force
```

### Unknown persona

```
Error: Unknown persona: fast_founder. Available: speed_saas_founder, ...
```

Use `--list-personas` to see available personas.

### Feedback not applied

Make sure to save the pilot after recording feedback:

```python
pilot.record_feedback(...)
store.save(pilot)  # Don't forget this!
```
